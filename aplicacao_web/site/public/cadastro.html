<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Jiu Connect | Cadastro</title>

  <!-- <script src="./js/sessao.js"></script> -->

  <!-- Biblioteca de mascara input -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.11/jquery.mask.min.js"></script>
  
  <link rel="icon" href="assets/logo.ico" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link rel="stylesheet" href="css/cadastro.css">
</head>



<style>


</style>




<div id="modal" class="modal">
  <div class="flex">

    <span class="close">&times;</span>

    <div class="erro_box">
      <p class="erro_titulo">Algo deu errado</p>
      <div class="erro_texto">

        <p id="mensagem_erro">Ops! Algo de errado verifique o campo <span id="alerta_modal"></span></p>

      </div>
    </div>
  </div>
</div>

<!-- <div id="modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3 id="mensagem_erro">Ops! Algo de errado verifique o campo <span id="alerta_modal"></span></h3>
  </div>
</div> -->

<body>
  <section class="cadastro_sec">
    <div id="tela_inicial" class="login-container">
      <h2 style="margin-bottom: 10%;">Cadastro</h2>
      <form class="login-form">

        <label for="username">Nome:</label>
        <input placeholder="Insira seu nome:" type="text" id="input_nome" required>

        <label for="password">Sobrenome:</label>
        <input placeholder="Insira seu Sobrenome:" id="" type="text" id="input_sobrenome" required>

        <label for="username">E-mail do Usuário:</label>
        <input placeholder="Insira seu E-mail:" type="text" id="input_usermail" required>

        <label for="password">Senha:</label>
        <input placeholder="Insira sua senha:" type="password" id="input_senha1" required>

        <label for="password">Repita a senha:</label>
        <input placeholder="Insira sua senha novamente:" type="password" id="input_senha2" required>

        <label for="password">Telefone:</label>
        <input placeholder="Insira seu telefone:" type="text" id="input_telefone" required>

        <label for="password">Data de nascimento:</label>
        <input placeholder="Insira sua data de nascimento:" type="date" id="input_dtNasc" required>

        <button style="width: 106%; margin-top: 5%; margin-bottom: 5%;" type="button"
          onclick="verificar()">Avançar</button>

        <a class="se-cadastre" href="login.html">
          <span>Ja tenho login</span>
        </a>
      </form>
    </div>


    <div style="display: none;" id="tela_final" class="login-container">
      <h2 style="margin-bottom: 10%;">Perfil</h2>
      <form class="login-form">

        <label for="username">Team:</label>
        <input placeholder="Insira o nome da sua academia:" type="text" id="input_team" required>

        <label for="password">Faixa:</label>
        <select id="select_faixa">

          <option selected disabled value="#">Selecione sua faixa</option>
          <option value="branca">Faixa Branca</option>
          <option value="cinza_branca">Faixa Cinza e Branca</option>
          <option value="cinza">Faixa Cinza</option>
          <option value="cinza_preta">Faixa Cinza e Preta</option>
          <option value="amarela_branca">Faixa Amarela e Branca</option>
          <option value="amarela">Faixa Amarela</option>
          <option value="amarela_preta">Faixa Amarela e Preta</option>
          <option value="laranja_branca">Faixa Laranja e Branca</option>
          <option value="laranja">Faixa Laranja</option>
          <option value="laranja_preta">Faixa Laranja e Preta</option>
          <option value="verde_branca">Faixa Verde e Branca</option>
          <option value="verde">Faixa Verde</option>
          <option value="verde_preta">Faixa Verde e Preta</option>
          <option value="azul">Faixa Azul</option>
          <option value="roxa">Faixa Roxa</option>
          <option value="marrom">Faixa Marrom</option>
          <option value="preta">Faixa Preta</option>
        </select>

        </select>

        <label for="username">Grau da sua faixa:</label>
        <select id="select_grau">

          <option disabled selected value="#">Selecione o grau da sua faixa</option>
          <option value="0°">0°</option>
          <option value="1°">1°</option>
          <option value="2°">2°</option>
          <option value="3°">3°</option>
          <option value="4°">4°</option>
          <option value="5°">5°</option>
          <option value="6°">6°</option>
          <option value="7°">7°</option>
          <option value="8°">8°</option>
          <option value="9°">9°</option>

        </select>

        <button style="width: 106%; margin-top: 5%; margin-bottom: 5%;" type="button"
          onclick="cadastrar()">cadastrar</button>

      </form>
    </div>

  </section>
</body>

</html>

<script>



$("#input_telefone").mask("(00) 00000-0000");
 
    

  function verificar() {
    var testeFinal = true;
    var inputEmail = input_usermail.value;
    var telefone = input_telefone;
    var senha1 = input_senha1.value;
    var senha2 = input_senha2.value;
    var indice_arroba = inputEmail.indexOf('@');
    var indice_ponto = inputEmail.lastIndexOf('.');
    var dataNascimento = new Date(document.getElementById('input_dtNasc').value);
    var dataAtual = new Date();
    var validarIdade = dataAtual.getFullYear() - dataNascimento.getFullYear();

    

    if (validarIdade < 18 || dataNascimento == null) {
      modal.style.display = 'block';
      alerta_modal.innerHTML = `idade, você precisa ser maior de idade`;

      testeFinal = false;
    }
    if (indice_arroba < 0 || indice_ponto < 0 || indice_ponto < indice_arroba + 2 || indice_ponto === inputEmail.length - 1) {
      modal.style.display = 'block';
      alerta_modal.innerHTML = `email`;

      testeFinal = false;

    }
    if (senha1 != senha2) {
      modal.style.display = 'block';
      alerta_modal.innerHTML = `senha, as senhas devem ser iguais`;

      testeFinal = false;
    }
    if (senha1.length <= 8 || senha2.length <= 8) {
      modal.style.display = 'block';
      alerta_modal.innerHTML = `senha, deve ter mais de 8 caracteres`;

      testeFinal = false;
    }

    if (testeFinal == true) {
      tela_inicial.style.display = 'none';
      tela_final.style.display = 'block';
    }

    document.querySelector('.close').addEventListener('click', function () {
      document.getElementById('modal').style.display = 'none';
    });

  }

  function cadastrar() {


    nomeVar = input_nome.value;
    sobrenomeVar = input_sobrenome.value;
    emailVar = input_usermail.value;
    senhaVar = input_senha1.value;
    telefoneVar = input_telefone.value;
    dtNascimentoVar = input_dtNasc.value;

    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        sobrenomeServer: sobrenomeVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
        telefoneServer: telefoneVar,
        dtNascimentoServer: dtNascimentoVar
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          modal.style.display = "block";

          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
  }


</script>
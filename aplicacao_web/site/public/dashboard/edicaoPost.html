<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>publicar</title>

    <link rel="stylesheet" href="../css/dashboards.css">
    <link rel="stylesheet" href="../css/publicar.css">
</head>

<body>

    <div id="modalVerde" class="modalVerde">
        <div class="flex">

            <div class="sucesso_box">
                <p class="sucesso_titulo">Sucesso!</p>
                <div class="sucesso_texto">

                    <p id="mensagem_sucesso"></p>

                </div>
            </div>
        </div>
    </div>

    <div id="modalApagar" class="modalApagar">

        <div>
            Você tem certeza que deseja apagar
        </div>
        <div class="buttonModal_box">
            <button id="simDel">Sim</button> <button onclick="fecharModalExcluir()">Não</button>
        </div>

    </div>

    <div id="modalVerde" class="modalVerde">
        <div class="flex">

            <div class="sucesso_box">
                <p class="sucesso_titulo">Sucesso!</p>
                <div class="sucesso_texto">

                    <p id="mensagem_sucesso"></p>

                </div>
            </div>
        </div>
    </div>

    <div class="dash_box">
        <div class="menu_box">

            <a href="dashboard.html">Principal</a>
            <a href="evolucao.html">Evolução</a>
            <a href="publicar.html">Publicar</a>
            <a onclick="limparSessao()">Sair</a>

        </div>

        <section class="conteudo">
            <div class="centro">
                <div class="publicar">
                    <div id="alerta">
                    </div>
                    <div class="container">
                        <h1>Publicar um aviso</h1>
                        <div class="div-form">
                           
                                <label>
                                    Título:
                                    <br>
                                    <input name="titulo" id="input_titulo" maxlength="100" type="text">
                                </label>
                                <br>
                                <br>
                                <label>
                                    Descrição (máximo de 250 caracteres):
                                    <br>
                                    <textarea name="descricao" id="textarea_descricao" maxlength="250"
                                        rows="5"></textarea>
                                </label>
                                <br>
                                <br>
                                <button onclick="editar()">Enviar</button>
                            
                        </div>
                        <h1>Mural de publicações</h1>
                        <div class="div-results">
                            <div id="feed_container" class="feed-container">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>

<script>


function editar() {
        fetch(`/avisos/editar/${sessionStorage.getItem("ID_POSTAGEM_EDITANDO")}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                descricao: textarea_descricao.value,
                titulo: input_titulo.value
            })
        }).then(function (resposta) {

            if (resposta.ok) {

                mensagem_sucesso.innerHTML = `Post editado com sucesso`;
                modalVerde.style.display = `block`;

                setTimeout(() => {
                    modalVerde.style.display = `none`;
                    window.location = "publicar.html"
                }, "3000");

               
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

</script>
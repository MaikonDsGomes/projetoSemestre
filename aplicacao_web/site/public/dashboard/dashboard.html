<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="icon" href="../assets/logo.ico" />
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jiu Connect | Dashboard</title>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="./../css/dashboards.css">
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>

</head>



<body onload="atualizarFeed(), atualizarFeedMedalha()">


    <div class="dash_box">



        <div class="menu_box">

            <a href="dashboard.html">Principal</a>
            <a href="evolucao.html">Evolução</a>
            <a onclick="limparSessao()">Sair</a>

        </div>

        <div id="modalApagar" class="modalApagar">

            <div>
                Você tem certeza que deseja apagar
            </div>
            <div class="buttonModal_box">
                <button onclick="fecharModalExcluir()">Sim</button> <button onclick="fecharModalExcluir()">Não</button>
            </div>

        </div>



        <section class="conteudo">

            <h1 class="titulo_pg">Principal</h1>

            <div class="centro">
                <div id="modalAdicionarPat" class="modalAdicionarPat modalInfoGerais">
                    <div>
                        <i onclick="fecharAdicionarPat()" class="fa-solid fa-x"></i>
                    </div>

                    <form>
                        <label>Onde o patrocinio fica no kimono ?</label>
                        <select id="select_lugarPat">
                            <option>Costas</option>
                            <option>Costas-2</option>
                            <option>Peito-dir</option>
                            <option>Peito-esq</option>
                            <option>Perna-dir</option>
                            <option>Peito-esq</option>
                            <option>Cóccix</option>
                        </select>
                        <label>Nome da empresa</label>
                        <input type="text" id="input_empresa">
                        <label>Segmento da empresa</label>
                        <select id="select_segmento">
                            <option>Alimentação</option>
                            <option>Clinicas</option>
                            <option>Vestimenta</option>
                            <option>Outro</option>
                        </select>
                    </form>
                    <div>
                        <button onclick="enviarAdicionarPat()">Adicionar</button>
                    </div>
                </div>
            </div>

            <div class="centro">
                <div id="modalEditarUser" class="modalEditarUser modalInfoGerais">
                    <div>
                        <i onclick="fecharEditarUser()" class="fa-solid fa-x"></i>
                    </div>

                    <form>
                        <label>Nome:</label>
                        <input placeholder="Insira seu nome:" type="text" id="input_nome" required>

                        <label>Sobrenome:</label>
                        <input placeholder="Insira seu Sobrenome:" type="text" id="input_sobrenome" required>

                        <label>E-mail do Usuário:</label>
                        <input placeholder="Insira seu E-mail:" type="text" id="input_email" required>

                        <label>Senha:</label>
                        <input placeholder="Insira sua senha:" type="password" id="input_senha1" required>

                        <label>Repita a senha:</label>
                        <input placeholder="Insira sua senha novamente:" type="password" id="input_senha2" required>

                        <label>Telefone:</label>
                        <input placeholder="Insira seu telefone:" type="text" id="input_telefone" required>

                        <label>Cep:</label>
                        <input maxlength="9" placeholder="Insira seu cep:" type="text" id="input_cep" required>

                        <label>Team:</label>
                        <input type="text" id="input_team" required>

                        <label>Faixa:</label>
                        <select id="select_faixa">

                            <option value="branca">Faixa Branca</option>
                            <option value="cinza_branca">Faixa Cinza e Branca</option>
                            <option value="cinza">Faixa Cinza</option>
                            <option value="cinza_preta">Faixa Cinza e Preta</option>
                            <option value="amarela_branca">Faixa Amarela e Branca</option>
                            <option value="amarela">Faixa Amarela</option>
                            <option value="amarela_preta">Faixa Amarela e Preta</option>
                            <option value="laranja_branca">Faixa Laranja e Branca</option>
                            <option value="laranja">Faixa Laranja</option>
                            <option value="laranja_preta">Faixa Laranja e Preta</option>
                            <option value="verde_branca">Faixa Verde e Branca</option>
                            <option value="verde">Faixa Verde</option>
                            <option value="verde_preta">Faixa Verde e Preta</option>
                            <option value="azul">Faixa Azul</option>
                            <option value="roxa">Faixa Roxa</option>
                            <option value="marrom">Faixa Marrom</option>
                            <option value="preta">Faixa Preta</option>
                        </select>

                        </select>

                        <label>Grau da sua faixa:</label>
                        <select id="select_grau">

                            <option value="0°">0°</option>
                            <option value="1°">1°</option>
                            <option value="2°">2°</option>
                            <option value="3°">3°</option>
                            <option value="4°">4°</option>
                            <option value="5°">5°</option>
                            <option value="6°">6°</option>
                            <option value="7°">7°</option>
                            <option value="8°">8°</option>
                            <option value="9°">9°</option>

                        </select>

                    </form>
                    <div>
                        <button onclick="enviarEditarUser()">Editar</button>
                    </div>
                </div>
            </div>
            <div class="centro">
                <div id="modalAdicionarMed" class="modalAdicionarMed modalInfoGerais">
                    <div>
                        <i onclick="fecharAdicionarMed()" class="fa-solid fa-x"></i>
                    </div>

                    <form>

                        <label>Federação</label>
                        <input type="text" id="input_federacao">
                        <label>Campeonato</label>
                        <input type="text" id="input_campeonato">
                        <label>Data</label>
                        <input type="date" id="input_data">
                        <label>Posição</label>
                        <select id="select_posicao">
                            <option value="1°">1° Lugar</option>
                            <option value="2°">2° Lugar</option>
                            <option value="3°">3° Lugar</option>
                            <option value="4°">4° Lugar</option>
                        </select>

                    </form>
                    <div>
                        <button onclick="enviarAdicionarMed()">Adicionar</button>
                    </div>
                </div>
            </div>

            <div id="centro_div" class="centro">
                <div>
                    <div class="cards_inf_box">

                        <div class="card_info_box">

                            <h1>Informações</h1>

                            <p><span id="nome_user"></span></p>
                            <p><span id="team_user"></span></p>
                            <p><span id="cep_user"></span></p>
                            <p><span id="email_user"></span></p>
                            <p><span id="faixa_user"></span> - <span id="grau_user"></span></p>

                            <button onclick="abrirEditarUser()">Editar</button>
                        </div>

                        <div class="card_pat_box ">
                            <h1>Patrocinio</h1>
                            <div id="patrocinio_container" class="scroll_box">
                                <!-- <p>
                                    <span>Local: Costas</span> - <span>Marca: Kvara</span> - <span>Segmento:
                                        Vestimentas</span>
                                    <i onclick="abrirModalApagar()" class="fa-solid fa-trash"></i>
                                </p> -->


                            </div>
                            <button onclick="abrirAdicionarPat()">Adicionar</button>
                        </div>

                    </div>
                    <div class="cards_inf_box">
                        <div class="medalhas_box">
                            <h1>Medalhas</h1>

                            <div id="medalha_container">
                                <!-- <span>
                                    <span>Federação: CBJJ</span>
                                    <span>Campeonato: Brasileiro OPEN</span>
                                    <span>Posição: 1° lugar</span>
                                    <span>Data: 12/12/2000</span>
                                </span> -->
                            </div>

                            <button onclick="abrirAdicionarMed()">Adicionar</button>
                        </div>

                    </div>
                    <div class="cards_inf_box">
                        <div>
                            <h1>Nivel dos atletas</h1>
                            <canvas id="myChart"></canvas>
                        </div>
                        <div>
                            <h1>Quantidade de alunos por faixas</h1>
                            <canvas style="height: 259px; display: block; box-sizing: border-box; width: 519px;"
                                id="myChartBar" width="519" height="350"></canvas>
                        </div>
                    </div>
                </div>

            </div>
        </section>


    </div>




</body>

</html>

<script>

    // STORAGE INFORMAÇÃO


    var idAtleta_sto = sessionStorage.ID_USUARIO
    var nome_sto = sessionStorage.NOME_USUARIO

    //console.log(`ID do user: ${idAtleta_sto}`)

    var sobrenome_sto = sessionStorage.SOBRENOME_USUARIO
    var email_sto = sessionStorage.EMAIL_USUARIO
    var senha_sto = sessionStorage.SENHA
    var telefone_sto = sessionStorage.TELEFONE_USUARIO
    var cep_sto = sessionStorage.CEP_USUARIO

    //var dtNascimento_sto = sessionStorage.DTNASCIMENTO_USUARIO
    //console.log(`Data: ${dtNascimento_sto}`)

    var team_sto = sessionStorage.TEAM_USUARIO
    var faixa_sto = sessionStorage.FAIXA_USUARIO
    var grau_sto = sessionStorage.GRAU_USUARIO

    nome_user.innerHTML = nome_sto;
    team_user.innerHTML = `Team: ${team_sto}`;
    cep_user.innerHTML = `Cep: ${cep_sto}`;
    email_user.innerHTML = `Email: ${email_sto}`;
    faixa_user.innerHTML = `Faixa: ${faixa_sto}`;
    grau_user.innerHTML = grau_sto;


    function abrirModalApagar() {
        modalApagar.style.display = 'block'
    }

    function fecharModalExcluir() {
        modalApagar.style.display = 'none'
    }

    function abrirAdicionarPat() {
        modalAdicionarPat.style.display = 'flex';
        centro_div.style.display = 'none'
    }

    function enviarAdicionarPat() {

        var lugarVar = select_lugarPat.value;
        var nomeEmpVar = input_empresa.value;
        var segmentoVar = select_segmento.value;

        fetch("/usuarios/adicionarPat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js

                lugarServer: lugarVar,
                nomeEmpServer: nomeEmpVar,
                segmentoServer: segmentoVar,
                idAtletaServer: idAtleta_sto

            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    window.location.reload();
                    //ADD ALERT DEPOIS  
                    modalAdicionarPat.style.display = 'none';
                    centro_div.style.display = 'block'


                } else {

                    throw "Houve um erro ao tentar realizar ao adicionar UM PATROCINIO!";

                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                modalAdicionarPat.style.display = 'block';
                centro_div.style.display = 'none'
            });

        return false;


    }

    function fecharEditarUser() {
        modalEditarUser.style.display = 'none';
        centro_div.style.display = 'block'
    }

    function abrirEditarUser() {

        input_nome.value = nome_sto
        input_sobrenome.value = sobrenome_sto
        input_email.value = email_sto
        input_senha1.value = senha_sto
        input_senha2.value = senha_sto
        input_telefone.value = telefone_sto
        input_cep.value = cep_sto
        select_faixa.value = faixa_sto
        select_grau.value = grau_sto
        //input_dtNasc.value = dtNascimento_sto
        input_team.value = team_sto

        modalEditarUser.style.display = 'flex';
        centro_div.style.display = 'none'

    }

    function enviarEditarUser() {
        var nomeVar = input_nome.value;
        var sobrenomeVar = input_sobrenome.value;
        var emailVar = input_email.value;
        var senhaVar = input_senha1.value;
        var telefoneVar = input_telefone.value;
        //var dtNascimentoVar = input_dtNasc.value;
        var cepVar = input_cep.value;

        var teamVar = input_team.value;
        var faixaVar = select_faixa.value;
        var grauVar = select_grau.value;

        fetch("/usuarios/editar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                sobrenomeServer: sobrenomeVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                telefoneServer: telefoneVar,
                cepServer: cepVar,
                //dtNascimentoServer: dtNascimentoVar,
                teamServer: teamVar,
                faixaServer: faixaVar,
                grauServer: grauVar,
                idAtletaServer: idAtleta_sto



            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    fetch("/usuarios/autenticar", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            emailServer: emailVar,
                            senhaServer: senhaVar
                        })
                    }).then(function (resposta) {
                        console.log("ESTOU NO THEN DO entrar()!")

                        if (resposta.ok) {
                            console.log(resposta);

                            resposta.json().then(json => {
                                console.log(json);
                                console.log(JSON.stringify(json));

                                sessionStorage.ID_USUARIO = json.idAtleta;
                                sessionStorage.NOME_USUARIO = json.nome;
                                sessionStorage.SOBRENOME_USUARIO = json.sobrenome;
                                sessionStorage.EMAIL_USUARIO = json.email;
                                sessionStorage.SENHA = json.senha;
                                sessionStorage.TELEFONE_USUARIO = json.telefone;
                                sessionStorage.CEP_USUARIO = json.cep;
                                // Tive problema com isso
                                //sessionStorage.DTNASCIMENTO_USUARIO = json.dtNascimento;
                                sessionStorage.TEAM_USUARIO = json.team;
                                sessionStorage.FAIXA_USUARIO = json.faixa;
                                sessionStorage.GRAU_USUARIO = json.grau;

                                //sessionStorage.AQUARIOS = JSON.stringify(json.aquarios)

                                setTimeout(function () {
                                    window.location = "dashboard.html";
                                }, 1000); // apenas para exibir o loading

                            });

                        } else {

                            console.log("Houve um erro ao tentar realizar o login!");
                            alerta_modal.innerHTML = `Email e/ou senha está incorreto!`;
                            modal.style.display = 'block';
                            resposta.text().then(texto => {
                                console.error(texto);

                            });
                        }

                    }).catch(function (erro) {
                        console.log(erro);
                        ;

                    })

                    return false;

                    modalEditarUser.style.display = 'none';
                    centro_div.style.display = 'block'

                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";

                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                modalEditarUser.style.display = 'block';
                centro_div.style.display = 'none'
            });

        return false;
    }

    function abrirAdicionarMed() {
        modalAdicionarMed.style.display = 'block';
        centro_div.style.display = 'none'
    }

    function fecharAdicionarMed() {
        modalAdicionarMed.style.display = 'none';
        centro_div.style.display = 'block'
    }
    function enviarAdicionarMed() {

        var federacaoVar = input_federacao.value;
        var dtVar = input_data.value;
        var posicaoVar = select_posicao.value;
        var nomeVar = input_campeonato.value;

        fetch("/usuarios/adicionarMed", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js

                federacaoServer: federacaoVar,
                dtServer: dtVar,
                posicaoServer: posicaoVar,
                nomeServer: nomeVar,
                idAtletaServer: idAtleta_sto

            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    window.location.reload();
                    modalAdicionarMed.style.display = 'none';
                    centro_div.style.display = 'block'

                } else {
                    console.log(`Posição: ${posicaoVar} --- Posição tamanho: ${posicaoVar.length}`)
                    throw "Houve um erro ao tentar realizar ao adicionar UMA MEDALHA!";

                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                modalAdicionarMed.style.display = 'block';
                centro_div.style.display = 'none'
            });

        return false;
    }


    // LISTAR 
    function atualizarFeed() {

        var idAtleta = idAtleta_sto;

        console.log(`ATLETA ID NO DASHBOARD ATUALIZAR FEED  --  ${idAtleta}`)

        fetch(`/avisos/listar/${idAtleta}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var patrocinio = document.getElementById("patrocinio_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    patrocinio.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var patrocinio = document.getElementById("patrocinio_container");
                    patrocinio.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        var pElement = document.createElement("p");
                        var spanLocal = document.createElement("span");
                        var spanMarca = document.createElement("span");
                        var spanSegmento = document.createElement("span");
                        var iconTrash = document.createElement("i");

                        spanLocal.innerHTML = "<b> Local: </b>" + publicacao.lugar;
                        spanMarca.innerHTML = "<b>Empresa: </b>" + publicacao.empresa;
                        spanSegmento.innerHTML = "<b>Segmento: </b> " + publicacao.segmento;
                        iconTrash.className = "fa-solid fa-trash";
                        iconTrash.setAttribute("onclick", "abrirModalApagar()");
                        spanLocal.id = "inputNumero" + publicacao.idAtleta;

                        iconTrash.id = "btnDeletar" + publicacao.idAtleta;
                        iconTrash.setAttribute("onclick", `deletar(${publicacao.idAtleta})`);

                        pElement.appendChild(spanLocal);
                        pElement.appendChild(document.createTextNode(" - "));
                        pElement.appendChild(spanMarca);
                        pElement.appendChild(document.createTextNode(" - "));
                        pElement.appendChild(spanSegmento);
                        pElement.appendChild(document.createTextNode(" "));
                        pElement.appendChild(iconTrash);


                        patrocinio.appendChild(pElement);

                        //  
                        //   <span>Local: Costas</span> - 
                        //           <span>Marca: Kvara</span> - 
                        //           <span>Segmento: Vestimentas</span> 
                        //          <i onclick="abrirModalApagar()"class="fa-solid fa-trash"></i>
                        //      
                    }


                });
            } else {
                console.log("id do atleta" + idAtleta)
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);

        });
    }


    function atualizarFeedMedalha() {

        var idAtleta = idAtleta_sto;

        console.log(`ATLETA ID NO DASHBOARD MEDALHA  --  ${idAtleta}`)

        fetch(`/avisos/listarMedalha/${idAtleta}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var patrocinio = document.getElementById("patrocinio_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    patrocinio.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var patrocinio = document.getElementById("patrocinio_container");
                    patrocinio.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var medalha = resposta[i];

                        // Criação dos elementos principais
                        var spanElement = document.createElement("span");
                        var divOrg = document.createElement("div");
                        var spanFederacao = document.createElement("span");
                        var spanCampeonato = document.createElement("span");
                        var spanPosicao = document.createElement("span");
                        var spanData = document.createElement("span");

                        spanElement.className = "span_medalhas_box";

                        // Definindo o conteúdo de cada elemento span
                        spanFederacao.innerHTML = "<b>Federação: </b> "+ medalha.federacao;
                        spanCampeonato.innerHTML = "<b>Campeonato: </b> "+ medalha.campeonato;
                        spanPosicao.innerHTML = "<b>Posição: </b>" + medalha.posicao + " Lugar";
                        spanData.innerHTML = "<b>Data: </b>" + medalha.ano;

                        // Adicionando os spans criados ao span principal
                        spanElement.appendChild(spanFederacao);
                        spanElement.appendChild(document.createTextNode(" - "));
                        spanElement.appendChild(spanCampeonato);
                        spanElement.appendChild(document.createTextNode(" - "));
                        spanElement.appendChild(spanPosicao);
                        spanElement.appendChild(document.createTextNode(" - "));
                        spanElement.appendChild(spanData);

                        // Adicionando o span principal ao elemento de destino no DOM (ajuste o seletor conforme necessário)
                        document.getElementById("medalha_container").appendChild(spanElement);

                        
                    }


                });
            } else {
                console.log("id do atleta" + idAtleta)
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);

        });
    }



    const ctx = document.getElementById('myChart');

    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Estadual', 'Nacional', 'Internacional', 'Mundial'],
            datasets: [{
                label: 'Nivel dos atletas',
                data: [24, 36, 30, 10],
                backgroundColor: [
                    'rgb(255, 99, 132)',
                    'rgb(54, 162, 235)',
                    'rgb(255, 205, 86)',
                    'rgb(25, 179, 49)'
                ],
            }]
        }
    });

    const ctxBar = document.getElementById('myChartBar');

    new Chart(ctxBar, {
        type: 'bar',
        data: {
            labels: ['Branca', 'Azul', 'Roxa', 'Marrom', 'Preta'],
            datasets: [{
                label: 'Alunos por faixa',
                data: [5, 10, 4, 15, 7],
                borderWidth: 2,
                borderColor: '#1a1a2e',
                backgroundColor: [
                    'white',
                    'blue',
                    'purple',
                    'brown',
                    'black'
                ],
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    /*
     
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
     
    let proximaAtualizacao;
     
    window.onload = exibirAquariosDoUsuario();
     
    function exibirAquariosDoUsuario() {
    var aquarios = JSON.parse(sessionStorage.AQUARIOS);
    aquarios.forEach(item => {
    document.getElementById("btnAquario").innerHTML += `
    <button class="btn-chart" onclick="exibirAquario(${item.id})" id="btnAquario${item.id}">${item.descricao}</button>
    `
     
    document.getElementById("graficos").innerHTML += `
        <div id="grafico${item.id}" class="display-none">
            <h3 class="tituloGraficos">
                <span id="tituloAquario${item.id}">${item.descricao}</span>
            </h3>
            <div class="graph">
                <canvas id="myChartCanvas${item.id}"></canvas>
            </div>
            <div class="label-captura">
                <p id="avisoCaptura${item.id}" style="color: white"></p>
            </div>
        </div>
    `
     
    obterDadosGrafico(item.id)
    });
     
    if (aquarios.length > 0) {
    exibirAquario(aquarios[0].id)
    }
    }
     
    function alterarTitulo(idAquario) {
    var tituloAquario = document.getElementById(`tituloAquario${idAquario}`)
    var descricao = JSON.parse(sessionStorage.AQUARIOS).find(item => item.id == idAquario).descricao;
    tituloAquario.innerHTML = "Últimas medidas de Temperatura e Umidade do <span style='color: #e6005a'>" + descricao + "</span>"
    }
     
    function exibirAquario(idAquario) {
    let todosOsGraficos = JSON.parse(sessionStorage.AQUARIOS);
     
    for (i = 0; i < todosOsGraficos.length; i++) {
    // exibindo - ou não - o gráfico
    if (todosOsGraficos[i].id != idAquario) {
        let elementoAtual = document.getElementById(`grafico${todosOsGraficos[i].id}`)
        if (elementoAtual.classList.contains("display-block")) {
            elementoAtual.classList.remove("display-block")
        }
        elementoAtual.classList.add("display-none")
     
        // alterando estilo do botão
        let btnAtual = document.getElementById(`btnAquario${todosOsGraficos[i].id}`)
        if (btnAtual.classList.contains("btn-pink")) {
            btnAtual.classList.remove("btn-pink")
        }
        btnAtual.classList.add("btn-white")
    }
    }
     
    // exibindo - ou não - o gráfico
    let graficoExibir = document.getElementById(`grafico${idAquario}`)
    graficoExibir.classList.remove("display-none")
    graficoExibir.classList.add("display-block")
     
    // alterando estilo do botão
    let btnExibir = document.getElementById(`btnAquario${idAquario}`)
    btnExibir.classList.remove("btn-white")
    btnExibir.classList.add("btn-pink")
    }
     
    // O gráfico é construído com três funções:
    // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
    // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
    // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco
     
    // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
    // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
    // A função *obterDadosGrafico* também invoca a função *plotarGrafico*
     
    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function obterDadosGrafico(idAquario) {
     
    alterarTitulo(idAquario)
     
    if (proximaAtualizacao != undefined) {
    clearTimeout(proximaAtualizacao);
    }
     
    fetch(`/medidas/ultimas/${idAquario}`, { cache: 'no-store' }).then(function (response) {
    if (response.ok) {
        response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            resposta.reverse();
     
            plotarGrafico(resposta, idAquario);
     
        });
    } else {
        console.error('Nenhum dado encontrado ou erro na API');
    }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
    }
     
    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta, idAquario) {
     
    console.log('iniciando plotagem do gráfico...');
     
    // Criando estrutura para plotar gráfico - labels
    let labels = [];
     
    // Criando estrutura para plotar gráfico - dados
    let dados = {
    labels: labels,
    datasets: [{
        label: 'Umidade',
        data: [],
        fill: false,
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
    },
    {
        label: 'Temperatura',
        data: [],
        fill: false,
        borderColor: 'rgb(199, 52, 52)',
        tension: 0.1
    }]
    };
     
    console.log('----------------------------------------------')
    console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
    console.log(resposta)
     
    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < resposta.length; i++) {
    var registro = resposta[i];
    labels.push(registro.momento_grafico);
    dados.datasets[0].data.push(registro.umidade);
    dados.datasets[1].data.push(registro.temperatura);
    }
     
    console.log('----------------------------------------------')
    console.log('O gráfico será plotado com os respectivos valores:')
    console.log('Labels:')
    console.log(labels)
    console.log('Dados:')
    console.log(dados.datasets)
    console.log('----------------------------------------------')
     
    // Criando estrutura para plotar gráfico - config
    const config = {
    type: 'line',
    data: dados,
    };
     
    // Adicionando gráfico criado em div na tela
    let myChart = new Chart(
    document.getElementById(`myChartCanvas${idAquario}`),
    config
    );
     
    setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
    }
     
     
    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas, 
     
    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function atualizarGrafico(idAquario, dados, myChart) {
     
     
     
    fetch(`/medidas/tempo-real/${idAquario}`, { cache: 'no-store' }).then(function (response) {
    if (response.ok) {
        response.json().then(function (novoRegistro) {
     
            obterdados(idAquario);
            // alertar(novoRegistro, idAquario);
            console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
            console.log(`Dados atuais do gráfico:`);
            console.log(dados);
     
            let avisoCaptura = document.getElementById(`avisoCaptura${idAquario}`)
            avisoCaptura.innerHTML = ""
     
     
            if (novoRegistro[0].momento_grafico == dados.labels[dados.labels.length - 1]) {
                console.log("---------------------------------------------------------------")
                console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                console.log("Horário do novo dado capturado:")
                console.log(novoRegistro[0].momento_grafico)
                console.log("Horário do último dado capturado:")
                console.log(dados.labels[dados.labels.length - 1])
                console.log("---------------------------------------------------------------")
            } else {
                // tirando e colocando valores no gráfico
                dados.labels.shift(); // apagar o primeiro
                dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento
     
                dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade
     
                dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
                dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura
     
                myChart.update();
            }
     
            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
        });
    } else {
        console.error('Nenhum dado encontrado ou erro na API');
        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
    }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
     
     
     
    }
     
    */
</script>